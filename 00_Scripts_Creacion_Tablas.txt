--	Modelo Relacional de la base de datos:
--
--   -> CLIENTES (*NROCLI, NYAPE, DOMICILIO, LOCALIDAD, SALDOCLI)
--   -> RUBROS   (*COD_RUBRO, DESCRIPCION)
--   -> ARTICULOS(*NROARTIC, DESCRIPCION, RUBRO, STOCK, PTO_REPOSICION, PRECIO)
--   -> FACTURAS (*NROFACTURA, CLIENTE, FECHA, TOTAL)
--   -> DETALLES (*NROFACTURA, *RENGLON, ARTICULO, CANTIDAD, PRECIOUNI)

DROP TABLE IF EXISTS DETALLES;
DROP TABLE IF EXISTS FACTURAS;
DROP TABLE IF EXISTS ARTICULOS;
DROP TABLE IF EXISTS RUBROS;
DROP TABLE IF EXISTS CLIENTES;

CREATE TABLE CLIENTES
(NROCLI     INTEGER     NOT NULL,
 NYAPE      VARCHAR(20) NOT NULL,
 DOMICILIO  VARCHAR(30),
 LOCALIDAD  VARCHAR(20),
 SALDOCLI   DECIMAL(9,2) DEFAULT 0);
ALTER TABLE Clientes ADD CONSTRAINT Pk_Clientes PRIMARY KEY(nrocli);

CREATE TABLE RUBROS
(COD_RUBRO        INTEGER,
 DESCRIPCION      VARCHAR(30),
 CONSTRAINT PK_RUBROS PRIMARY KEY (COD_RUBRO) );

CREATE TABLE ARTICULOS
(NROARTIC         INTEGER NOT NULL,
 DESCRIPCION      VARCHAR(30) NOT NULL,
 RUBRO            INTEGER,
 STOCK            INTEGER NOT NULL DEFAULT 0 ,
 PTO_REPOSICION   INTEGER NOT NULL DEFAULT 0 ,
 PRECIO           DECIMAL(8,2) DEFAULT 0 ,
 CONSTRAINT PK_ARTICULOS PRIMARY KEY (NROARTIC),
 CONSTRAINT FK_ARTICULOS_RUBROS FOREIGN KEY (RUBRO) REFERENCES RUBROS(COD_RUBRO) ON DELETE NO ACTION);

CREATE TABLE FACTURAS
(NROFACTURA  INTEGER NOT NULL,
 CLIENTE     INTEGER NOT NULL,
 FECHA       TIMESTAMP NOT NULL DEFAULT NOW(),
 CONSTRAINT PK_FACTURAS PRIMARY KEY (NROFACTURA),
 CONSTRAINT FK_FACTURAS_CLIENTES FOREIGN KEY (CLIENTE) REFERENCES CLIENTES(NROCLI)
 ON DELETE NO ACTION
 ON UPDATE CASCADE);

CREATE TABLE DETALLES
(NROFACTURA  INTEGER NOT NULL CHECK(NROFACTURA > 0),
 RENGLON     CHAR(3) NOT NULL,
 ARTICULO    INTEGER NOT NULL,
 CANTIDAD    INTEGER NOT NULL,
 PRECIOUNI   DECIMAL(8,2), -- PRECIOUNI SIN "NOT NULL" Y SIN DEFAULT... SINO PROBLEMAS EN UPDATE
 PRIMARY KEY (NROFACTURA, RENGLON),
CONSTRAINT FK_DETALLES_FACTURAS FOREIGN KEY (NROFACTURA) REFERENCES FACTURAS(NROFACTURA) ON DELETE CASCADE);